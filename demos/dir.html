<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>WebAppFind directory path demo</title>
    <!-- WebAppFind -->
    <script>

(function () {'use strict';

var getDirectoryMessage = 'webapp-getDirectoryPath',
    excludedMessages = [getDirectoryMessage];

function $ (sel) {
    return document.querySelector(sel);
}

window.addEventListener('DOMContentLoaded', function () {
    var path;
    
    window.addEventListener('message', function(e) {
        if (e.origin !== window.location.origin || // PRIVACY AND SECURITY! (for viewing and saving, respectively)
            (!Array.isArray(e.data) || excludedMessages.indexOf(e.data[0]) > -1) // Validate format and avoid our post below
        ) {
            return;
        }
        var messageType = e.data[0];
        switch (messageType) {
            case 'webapp-directoryPath':
                // Populate the contents
                path = e.data[1];
                $('#dir').value = path;
                break;
            default:
                throw 'Unexpected type';
        }
    }, false);
    
    // This is not necessary, nor probably useful since the supplied path is not going to change!
    window.postMessage([getDirectoryMessage], window.location.origin);
});

}());
    </script>
</head>
<body>
<div id="dir-container">
<textarea id="dir" cols="100" rows="30" placeholder="Loading..."></textarea>
</div>
</body>
</html>
